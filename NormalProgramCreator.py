import os
import subprocess


class NormalProgramCreator():
    def __init__(self):
        pass


    def createDetailsFromList(self, programList=None, directory="/usr/bin/", detailsDirectory="~/normalProgramList/"):
        detailsDirectory = os.path.expanduser(detailsDirectory)
        if(not os.path.isdir(detailsDirectory)):
            os.mkdir(detailsDirectory)
        programs = list(filter(lambda x: checkProgramElf(directory + x), programList))
        for program in programs:
            print("Getting ", program)
            programDirectory = detailsDirectory + program + "/"
            if(not os.path.isdir(programDirectory)):
                os.mkdir(programDirectory)
            textfile = os.path.expanduser(detailsDirectory) + program + "/details.txt"
            f = open(textfile, "w+")
            proc = subprocess.Popen([directory + program, '--version'], stdout=subprocess.PIPE)
            version = proc.communicate()[0].decode('utf-8')
            f.write("location: " + directory + program + "\nversion: " + version)
            proc.kill()

    def printELFList(self, directory="/usr/bin/"):
        elflist = (list(filter(lambda x: checkProgramElf('/usr/bin/' + x), os.listdir(directory))))
        return elflist


def checkProgramElf(program):
    proc = subprocess.Popen(['file', program], stdout=subprocess.PIPE)
    fileDetails =  proc.communicate()[0].decode('utf-8')
    if('ELF' in fileDetails):
        return True
    return False
