import os
import subprocess

bannedList = ['curl', 'libmodplug', 'kerberos', 'miniupnpd']

class DataCreator:
    def __init__(self):
        pass

    def createFextractorStatic(self, rootdir):
        for dir in (os.listdir(os.path.expanduser(rootdir))):
            if(not dir in bannedList):
                self.fextracts(rootdir, dir)

    def createFextractorDynamic(self, rootdir):
        for dir in (os.listdir(os.path.expanduser(rootdir))):
            if(not dir in bannedList):
                self.fextractd(rootdir, dir)

    #create all vdiscover static data using fextractor
    def fextracts(self, rootdir, dir):
        os.chdir(os.path.expanduser(rootdir + dir))
        print(os.path.expanduser(rootdir + dir))
        f = open("details.txt", "r")
        path = list(filter(lambda x: "location" in x, f))[0].replace(" ", "").replace("\n", "").split(":")[1]
        path = os.path.expanduser(path)
        csv_file = dir + "_static.csv"
        print("Getting: ", dir)
        subprocess.run(['/home/dom/.local/bin/fextractor', '--static', '--out-file', csv_file, path])


    #create all vdiscover dynamic data using fextractor
    def fextractd(self, rootdir, dir):
        os.chdir(os.path.expanduser(rootdir + dir))
        f = open("details.txt", "r")
        path = list(filter(lambda x: "location" in x, f))[0].replace(" ", "").replace("\n", "").split(":")[1]
        path = os.path.expanduser(path)
        csv_file = dir + "_dynamic.csv"
        print("Getting: ", dir)
        os.chdir(os.path.expanduser(rootdir + dir + "/dynamic"))
        subprocess.run(['/home/dom/.local/bin/fextractor', '--timeout', '1',  '--dynamic', '--out-file', csv_file, path])
